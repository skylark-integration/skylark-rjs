{"version":3,"sources":["prim.js"],"names":["define","hasOwn","Object","prototype","hasOwnProperty","hasProp","obj","prop","call","each","ary","func","i","length","check","p","prim","hideResolutionConflict","Error","JSON","stringify","notify","value","nextTick","item","ok","fail","callback","yes","no","errback","v","push","e","finished","rejected","resolve","reject","start","fn","promise","then","next","err","e2","end","serial","result","setImmediate","process","setTimeout"],"mappings":";;;;;;;AAcAA,OAAO,WACH,aACA,IACIC,EADKC,OAAOC,UACAC,eAEhB,SAASC,EAAQC,EAAKC,GAClB,OAAON,EAAOO,KAAKF,EAAKC,GAO5B,SAASE,EAAKC,EAAKC,GAEX,IAAIC,EADR,GAAIF,EAEA,IAAKE,EAAI,EAAGA,EAAIF,EAAIG,OAAQD,GAAK,EACzBF,EAAIE,IACJD,EAAKD,EAAIE,GAAIA,EAAGF,GAMhC,SAASI,EAAMC,GACX,GAAIV,EAAQU,EAAG,MAAQV,EAAQU,EAAG,KAAM,CACpC,IAAKC,EAAKC,uBACN,MAAM,IAAIC,MAAM,kCACAC,KAAKC,UAAUL,IAEnC,OAAO,EAEX,OAAO,EAGX,SAASM,EAAOX,EAAKY,GACjBN,EAAKO,SAAS,WACVd,EAAKC,EAAK,SAAUc,GAChBA,EAAKF,OAKjB,SAASN,IACL,IAAID,EACAU,KACAC,KAEJ,OAAQX,GACJY,SAAU,SAAUC,EAAKC,GACjBA,GACAd,EAAEe,QAAQD,GAGVxB,EAAQU,EAAG,KACXC,EAAKO,SAAS,WACVK,EAAIb,EAAEgB,KAGVN,EAAGO,KAAKJ,IAIhBE,QAAS,SAAUD,GACXxB,EAAQU,EAAG,KACXC,EAAKO,SAAS,WACVM,EAAGd,EAAEkB,KAGTP,EAAKM,KAAKH,IAIlBK,SAAU,WACN,OAAO7B,EAAQU,EAAG,MAAQV,EAAQU,EAAG,MAGzCoB,SAAU,WACN,OAAO9B,EAAQU,EAAG,MAGtBqB,QAAS,SAAUL,GAKf,OAJIjB,EAAMC,KACNA,EAAEgB,EAAIA,EACNV,EAAOI,EAAIM,IAERhB,GAEXsB,OAAQ,SAAUJ,GAKd,OAJInB,EAAMC,KACNA,EAAEkB,EAAIA,EACNZ,EAAOK,EAAMO,IAEVlB,GAGXuB,MAAO,SAAUC,GAEb,OADAxB,EAAEqB,UACKrB,EAAEyB,QAAQC,KAAKF,IAG1BC,SACIC,KAAM,SAAUb,EAAKC,GACjB,IAAIa,EAAO1B,IAoCX,OAlCAD,EAAEY,SAAS,SAAUI,GACjB,IACQH,GAAsB,mBAARA,IACdG,EAAIH,EAAIG,IAGRA,GAAKA,EAAEU,KACPV,EAAEU,KAAKC,EAAKN,QAASM,EAAKL,QAE1BK,EAAKN,QAAQL,GAEnB,MAAOE,GACLS,EAAKL,OAAOJ,KAEjB,SAAUA,GACT,IAAIU,EAEJ,IACSd,GAAoB,mBAAPA,GAGdc,EAAMd,EAAGI,KAEEU,EAAIF,KACXE,EAAIF,KAAKC,EAAKN,QAASM,EAAKL,QAE5BK,EAAKN,QAAQO,GAPjBD,EAAKL,OAAOJ,GAUlB,MAAOW,GACLF,EAAKL,OAAOO,MAIbF,EAAKF,SAGhBd,KAAM,SAAUG,GACZ,OAAOd,EAAEyB,QAAQC,KAAK,KAAMZ,IAGhCgB,IAAK,WACD9B,EAAEe,QAAQ,SAAUG,GAChB,MAAMA,OA0B1B,OAnBAjB,EAAK8B,OAAS,SAAUpC,GACpB,IAAIqC,EAAS/B,IAAOoB,UAAUI,QAM9B,OALA/B,EAAKC,EAAK,SAAUc,GAChBuB,EAASA,EAAON,KAAK,WACjB,OAAOjB,QAGRuB,GAGX/B,EAAKO,SAAmC,mBAAjByB,aAA8BA,aAC7B,oBAAZC,SAA2BA,QAAQ1B,SACvC0B,QAAQ1B,SAAkC,oBAAf2B,WACvB,SAAUX,GACVW,WAAWX,EAAI,IACf,SAAUA,GAClBA,KAGGvB","file":"../prim.js","sourcesContent":["/**\n * prim 0.0.1 Copyright (c) 2012-2014, The Dojo Foundation All Rights Reserved.\n * Available via the MIT or new BSD license.\n * see: http://github.com/requirejs/prim for details\n */\n\n/*global setImmediate, process, setTimeout, define, module */\n\n//Set prime.hideResolutionConflict = true to allow \"resolution-races\"\n//in promise-tests to pass.\n//Since the goal of prim is to be a small impl for trusted code, it is\n//more important to normally throw in this case so that we can find\n//logic errors quicker.\n\ndefine(function () {\n    'use strict';\n    var op = Object.prototype,\n        hasOwn = op.hasOwnProperty;\n\n    function hasProp(obj, prop) {\n        return hasOwn.call(obj, prop);\n    }\n\n    /**\n     * Helper function for iterating over an array. If the func returns\n     * a true value, it will break out of the loop.\n     */\n    function each(ary, func) {\n        if (ary) {\n            var i;\n            for (i = 0; i < ary.length; i += 1) {\n                if (ary[i]) {\n                    func(ary[i], i, ary);\n                }\n            }\n        }\n    }\n\n    function check(p) {\n        if (hasProp(p, 'e') || hasProp(p, 'v')) {\n            if (!prim.hideResolutionConflict) {\n                throw new Error('Prim promise already resolved: ' +\n                                JSON.stringify(p));\n            }\n            return false;\n        }\n        return true;\n    }\n\n    function notify(ary, value) {\n        prim.nextTick(function () {\n            each(ary, function (item) {\n                item(value);\n            });\n        });\n    }\n\n    function prim() {\n        var p,\n            ok = [],\n            fail = [];\n\n        return (p = {\n            callback: function (yes, no) {\n                if (no) {\n                    p.errback(no);\n                }\n\n                if (hasProp(p, 'v')) {\n                    prim.nextTick(function () {\n                        yes(p.v);\n                    });\n                } else {\n                    ok.push(yes);\n                }\n            },\n\n            errback: function (no) {\n                if (hasProp(p, 'e')) {\n                    prim.nextTick(function () {\n                        no(p.e);\n                    });\n                } else {\n                    fail.push(no);\n                }\n            },\n\n            finished: function () {\n                return hasProp(p, 'e') || hasProp(p, 'v');\n            },\n\n            rejected: function () {\n                return hasProp(p, 'e');\n            },\n\n            resolve: function (v) {\n                if (check(p)) {\n                    p.v = v;\n                    notify(ok, v);\n                }\n                return p;\n            },\n            reject: function (e) {\n                if (check(p)) {\n                    p.e = e;\n                    notify(fail, e);\n                }\n                return p;\n            },\n\n            start: function (fn) {\n                p.resolve();\n                return p.promise.then(fn);\n            },\n\n            promise: {\n                then: function (yes, no) {\n                    var next = prim();\n\n                    p.callback(function (v) {\n                        try {\n                            if (yes && typeof yes === 'function') {\n                                v = yes(v);\n                            }\n\n                            if (v && v.then) {\n                                v.then(next.resolve, next.reject);\n                            } else {\n                                next.resolve(v);\n                            }\n                        } catch (e) {\n                            next.reject(e);\n                        }\n                    }, function (e) {\n                        var err;\n\n                        try {\n                            if (!no || typeof no !== 'function') {\n                                next.reject(e);\n                            } else {\n                                err = no(e);\n\n                                if (err && err.then) {\n                                    err.then(next.resolve, next.reject);\n                                } else {\n                                    next.resolve(err);\n                                }\n                            }\n                        } catch (e2) {\n                            next.reject(e2);\n                        }\n                    });\n\n                    return next.promise;\n                },\n\n                fail: function (no) {\n                    return p.promise.then(null, no);\n                },\n\n                end: function () {\n                    p.errback(function (e) {\n                        throw e;\n                    });\n                }\n            }\n        });\n    };\n\n    prim.serial = function (ary) {\n        var result = prim().resolve().promise;\n        each(ary, function (item) {\n            result = result.then(function () {\n                return item();\n            });\n        });\n        return result;\n    };\n\n    prim.nextTick = typeof setImmediate === 'function' ? setImmediate :\n        (typeof process !== 'undefined' && process.nextTick ?\n            process.nextTick : (typeof setTimeout !== 'undefined' ?\n                function (fn) {\n                setTimeout(fn, 0);\n            } : function (fn) {\n        fn();\n    }));\n\n    return prim;\n});"]}